<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><style>body.glightbox-open{overflow-y:scroll!important}</style><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Installation of Kubernetes on Debian Part 2 - Adding a Node | Zaft Memory Core </title><link rel=canonical href=https://davmig.github.io/posts/k8s-part2-adding-node/><meta name=description content="Welcome to Zaft Memory Core — a personal archive for my thoughts, ideas, and technical explorations. This platform is where I document my journey, from code snippets and project insights to creative concepts worth revisiting. It’s more than just a collection—it's a reflection of how I think, organize, and approach challenges. Designed to be simple yet effective, Zaft Memory Core keeps everything I need in one place, ready to evolve alongside my skills and interests. Because every idea deserves structure."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="https://davmig.github.io/posts/k8s-part2-adding-node/"><meta property="og:site_name" content="Zaft Memory Core "><meta property="og:title" content="Installation of Kubernetes on Debian Part 2 - Adding a Node"><meta property="og:description" content="Rationale In our previous post we installed Kubernetes control plane on a single node. Now we want to add a second node to our cluster to run our workloads. We will follow official documentation to add a node to our cluster.
Pre-requisites Before we join a node to the cluster, we need to have a node with the following :
should have tooling installed (kubeadm, kubelet) should have a container runtime installed (containerd in our case) we need super-user access to the node. Setup the node on vanilla Debian for the ease of setup, I will duplicate a template VM I’ve created before, I will just rename it to wnode-01 for worker-node-01 and change the hostname."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-17T09:00:00+00:00"><meta property="article:modified_time" content="2025-05-17T09:00:00+00:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="K8s"><meta name=twitter:card content="summary"><meta name=twitter:title content="Installation of Kubernetes on Debian Part 2 - Adding a Node"><meta name=twitter:description content="Rationale In our previous post we installed Kubernetes control plane on a single node. Now we want to add a second node to our cluster to run our workloads. We will follow official documentation to add a node to our cluster.
Pre-requisites Before we join a node to the cluster, we need to have a node with the following :
should have tooling installed (kubeadm, kubelet) should have a container runtime installed (containerd in our case) we need super-user access to the node. Setup the node on vanilla Debian for the ease of setup, I will duplicate a template VM I’ve created before, I will just rename it to wnode-01 for worker-node-01 and change the hostname."><link rel=stylesheet href=https://davmig.github.io/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css><script src=https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js></script><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://davmig.github.io/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Main</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li><li><a href=/posts/>Posts</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://davmig.github.io/posts/k8s-part1-control-plane-installation-on-debian/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://davmig.github.io/posts/k8s-part3-fluxcd-installation/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&text=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&title=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&is_video=false&description=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node&body=Check out this article: https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&title=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&title=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&name=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node&description=%3ch2%20id%3d%22rationale%22%3eRationale%3c%2fh2%3e%0a%3cp%3eIn%20our%20previous%20%3ca%20href%3d%22posts%2f2025-05-16.k8s.install%2f%22%3epost%3c%2fa%3e%20we%20installed%20Kubernetes%20control%20plane%20on%20a%20single%20node.%20Now%20we%20want%20to%20add%20a%20second%20node%20to%20our%20cluster%20to%20run%20our%20workloads.%20We%20will%20follow%20official%20%3ca%20href%3d%22https%3a%2f%2fkubernetes.io%2fdocs%2ftasks%2fadminister-cluster%2fkubeadm%2fadding-linux-nodes%2f%22%3edocumentation%3c%2fa%3e%20to%20add%20a%20node%20to%20our%20cluster.%3c%2fp%3e%0a%3ch2%20id%3d%22pre-requisites%22%3ePre-requisites%3c%2fh2%3e%0a%3cp%3eBefore%20we%20join%20a%20node%20to%20the%20cluster%2c%20we%20need%20to%20have%20a%20node%20with%20the%20following%20%3a%3c%2fp%3e%0a%3cul%3e%0a%3cli%3eshould%20have%20tooling%20installed%20%28kubeadm%2c%20kubelet%29%3c%2fli%3e%0a%3cli%3eshould%20have%20a%20container%20runtime%20installed%20%28containerd%20in%20our%20case%29%3c%2fli%3e%0a%3cli%3ewe%20need%20super-user%20access%20to%20the%20node.%3c%2fli%3e%0a%3c%2ful%3e%0a%3ch3%20id%3d%22setup-the-node-on-vanilla-debian%22%3eSetup%20the%20node%20on%20vanilla%20Debian%3c%2fh3%3e%0a%3cp%3efor%20the%20ease%20of%20setup%2c%20I%20will%20duplicate%20a%20template%20VM%20I%26rsquo%3bve%20created%20before%2c%20I%20will%20just%20rename%20it%20to%20%3ccode%3ewnode-01%3c%2fcode%3e%20for%20worker-node-01%20and%20change%20the%20hostname.%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&t=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#rationale>Rationale</a></li><li><a href=#pre-requisites>Pre-requisites</a><ul><li><a href=#setup-the-node-on-vanilla-debian>Setup the node on vanilla Debian</a></li><li><a href=#disable-swap>Disable swap</a></li><li><a href=#install-runtime>install runtime</a></li><li><a href=#install-tooling-and-kubelet>Install tooling and kubelet</a></li></ul></li><li><a href=#adding-the-node-to-the-cluster>Adding the node to the cluster</a><ul><li><a href=#getting-the-token>Getting the token</a></li><li><a href=#getting-the-hash>Getting the hash</a></li><li><a href=#joining-the-node-to-the-cluster>Joining the node to the cluster</a></li><li><a href=#checking-nodes-on-control-plane>Checking nodes on control plane</a></li></ul></li><li><a href=#checking>Checking</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Installation of Kubernetes on Debian Part 2 - Adding a Node</h1><div class=meta><div class=postdate><time datetime="2025-05-17 09:00:00 +0000 UTC" itemprop=datePublished>2025-05-17</time></div><div class=article-read-time><i class="far fa-clock"></i>
6 minute read</div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/notes>notes</a>
,
<a class=category-link href=/categories/k8s>k8s</a>
,
<a class=category-link href=/categories/kubernetes>kubernetes</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/kubernetes rel=tag>kubernetes</a>
,
<a class=tag-link href=/tags/k8s rel=tag>k8s</a></div></div></header><div class=content itemprop=articleBody><h2 id=rationale>Rationale</h2><p>In our previous <a href=posts/2025-05-16.k8s.install/>post</a> we installed Kubernetes control plane on a single node. Now we want to add a second node to our cluster to run our workloads. We will follow official <a href=https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/adding-linux-nodes/>documentation</a> to add a node to our cluster.</p><h2 id=pre-requisites>Pre-requisites</h2><p>Before we join a node to the cluster, we need to have a node with the following :</p><ul><li>should have tooling installed (kubeadm, kubelet)</li><li>should have a container runtime installed (containerd in our case)</li><li>we need super-user access to the node.</li></ul><h3 id=setup-the-node-on-vanilla-debian>Setup the node on vanilla Debian</h3><p>for the ease of setup, I will duplicate a template VM I&rsquo;ve created before, I will just rename it to <code>wnode-01</code> for worker-node-01 and change the hostname.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>david@node:~$ sudo vim  /etc/hostname
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>[</span>sudo<span style=color:#ff79c6>]</span> password <span style=color:#ff79c6>for</span> david:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>david@node:~$ sudo hostname <span style=color:#ff79c6>$(</span>cat /etc/hostname<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>david@node:~$ sudo init <span style=color:#bd93f9>6</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#ff79c6>[</span>...<span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>david@wnode-01:~$ hostname
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>wnode-01
</span></span></code></pre></div><h3 id=disable-swap>Disable swap</h3><p>We need to disable the swap otherwise Kubeadm will complain.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>david@wnode-01:~$ sudo swapoff -a
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>david@wnode-01:~$ sudo sed -i <span style=color:#f1fa8c>&#39;/swap/ s/^/#/&#39;</span> /etc/fstab
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>david@wnode-01:~$ grep swap /etc/fstab
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4>## swap was on /dev/sda5 during installation</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4>#UUID=19d62f10-216b-4978-a8a3-bc8c0a4caa21 none            swap    sw              0       0</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>david@wnode-01:~$
</span></span></code></pre></div><h3 id=install-runtime>install runtime</h3><p>Juste like in the previous post we use the official instructions to install the runtime.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4># Add Docker&#39;s official GPG key:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>sudo apt-get update
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>sudo apt-get install ca-certificates curl
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>sudo install -m <span style=color:#bd93f9>0755</span> -d /etc/apt/keyrings
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>sudo curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>sudo chmod a+r /etc/apt/keyrings/docker.asc
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4># Add the repository to Apt sources:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#f1fa8c></span>  <span style=color:#f1fa8c>&#34;deb [arch=</span><span style=color:#ff79c6>$(</span>dpkg --print-architecture<span style=color:#ff79c6>)</span><span style=color:#f1fa8c> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#f1fa8c>  </span><span style=color:#ff79c6>$(</span>. /etc/os-release <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$VERSION_CODENAME</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>)</span><span style=color:#f1fa8c> stable&#34;</span> | <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#f1fa8c></span>  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>sudo apt-get update
</span></span></code></pre></div><p>After that I only install containerd and not the other tools from the suite.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>david@wnode-01:~$ sudo apt-get install  containerd.io
</span></span></code></pre></div><p>Now that we have containerd installed and running, I&rsquo;ll configure it correctly, one of the guidelines in the manual is to generate a default config file and then edit it, let&rsquo;s do this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>david@wnode-01:~$ containerd config default | sudo tee /etc/containerd/config.toml &gt; /dev/null
</span></span></code></pre></div><p>And then we check and add missing config if needed, in this case I had to set <code>SystemdCgroup = true</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>david@wnode-01:~$ sudo vim /etc/containerd/config.toml
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>david@wnode-01:~$ grep -i systemdcgroup !$
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>grep -i systemdcgroup /etc/containerd/config.toml
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>            <span style=color:#8be9fd;font-style:italic>SystemdCgroup</span> <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>true</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>david@wnode-01:~$ sudo systemctl restart containerd
</span></span></code></pre></div><p>We also need to enable IP packet forwarding as per the documentation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4># sysctl params required by setup, params persist across reboots</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>cat <span style=color:#f1fa8c>&lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#f1fa8c>net.ipv4.ip_forward = 1
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#f1fa8c>EOF</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4># Apply sysctl params without reboot</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>sudo sysctl --system
</span></span></code></pre></div><h3 id=install-tooling-and-kubelet>Install tooling and kubelet</h3><p>As the steps are already documented on <a href=content/posts/2025-05-16.k8s.install/>Part 1</a>, I&rsquo;ll just put the command lines</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo apt-get install -y apt-transport-https ca-certificates curl gpg
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.33/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#39;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.33/deb/ /&#39;</span> | sudo tee /etc/apt/sources.list.d/kubernetes.list
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>sudo apt-get update
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>sudo apt-get install -y kubelet kubeadm
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>sudo apt-mark hold kubelet kubeadm
</span></span></code></pre></div><p>Pre-requisites are now complete.</p><h2 id=adding-the-node-to-the-cluster>Adding the node to the cluster</h2><p>We will use the <code>kubeadm join</code> command to add the node to the cluster. But before that we need to know the token and the hash of the cluster.</p><h3 id=getting-the-token>Getting the token</h3><p>For that purpose we will connect to the control plane in SSH and run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>david@node:~$ sudo kubeadm token list
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>TOKEN                     TTL         EXPIRES                USAGES                   DESCRIPTION                                                EXTRA GROUPS
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>0s5fak.2gueis11rlx8v3v1   8h          2025-05-17T20:50:07Z   authentication,signing   The default bootstrap token generated by <span style=color:#f1fa8c>&#39;kubeadm init&#39;</span>.   system:bootstrappers:kubeadm:default-node-token
</span></span></code></pre></div><p>This will gives us the token to use and as you can see, the token will expire after 24 hours.</p><h3 id=getting-the-hash>Getting the hash</h3><p>We also need the hash of the cluster. We can get it by running the following command (from official documentation):</p><pre tabindex=0><code>sudo cat /etc/kubernetes/pki/ca.crt | openssl x509 -pubkey  | openssl rsa -pubin -outform der 2&gt;/dev/null | \
   openssl dgst -sha256 -hex | sed &#39;s/^.* //&#39;
</code></pre><p>Output will be something like :</p><pre tabindex=0><code>8cb2de97839780a412b93877f8507ad6c94f73add17d5d7058e91741c9d5ec78
</code></pre><h3 id=joining-the-node-to-the-cluster>Joining the node to the cluster</h3><p>Now we can join the node to the cluster using the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo kubeadm join --token &lt;token&gt; &lt;control-plane-host&gt;:&lt;control-plane-port&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>Additional information <span style=color:#ff79c6>for</span> kubeadm join 
</span></span></code></pre></div><p>After running the command :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>david@wnode-01:~$ sudo kubeadm join --token 0s5fak.2gueis11rlx8v3v1 192.168.1.18:6443 --discovery-token-ca-cert-hash sha256:8cb2de97839780a412b93877f8507ad6c94f73add17d5d7058e91741c9d5ec78
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>[</span>preflight<span style=color:#ff79c6>]</span> Running pre-flight checks
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>[</span>preflight<span style=color:#ff79c6>]</span> Reading configuration from the <span style=color:#f1fa8c>&#34;kubeadm-config&#34;</span> ConfigMap in namespace <span style=color:#f1fa8c>&#34;kube-system&#34;</span>...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>[</span>preflight<span style=color:#ff79c6>]</span> Use <span style=color:#f1fa8c>&#39;kubeadm init phase upload-config --config your-config-file&#39;</span> to re-upload it.
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>[</span>kubelet-start<span style=color:#ff79c6>]</span> Writing kubelet configuration to file <span style=color:#f1fa8c>&#34;/var/lib/kubelet/config.yaml&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6>[</span>kubelet-start<span style=color:#ff79c6>]</span> Writing kubelet environment file with flags to file <span style=color:#f1fa8c>&#34;/var/lib/kubelet/kubeadm-flags.env&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>[</span>kubelet-start<span style=color:#ff79c6>]</span> Starting the kubelet
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#ff79c6>[</span>kubelet-check<span style=color:#ff79c6>]</span> Waiting <span style=color:#ff79c6>for</span> a healthy kubelet at http://127.0.0.1:10248/healthz. This can take up to 4m0s
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#ff79c6>[</span>kubelet-check<span style=color:#ff79c6>]</span> The kubelet is healthy after 508.793704ms
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#ff79c6>[</span>kubelet-start<span style=color:#ff79c6>]</span> Waiting <span style=color:#ff79c6>for</span> the kubelet to perform the TLS Bootstrap
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>This node has joined the cluster:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>* Certificate signing request was sent to apiserver and a response was received.
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>* The Kubelet was informed of the new secure connection details.
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>Run <span style=color:#f1fa8c>&#39;kubectl get nodes&#39;</span> on the control-plane to see this node join the cluster.
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>david@wnode-01:~$
</span></span></code></pre></div><h3 id=checking-nodes-on-control-plane>Checking nodes on control plane</h3><p>We then connect to the control plane and check the nodes using the command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>david@node:~$ kubectl get nodes
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>NAME       STATUS   ROLES           AGE    VERSION
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>node       Ready    control-plane   15h    v1.33.1
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>wnode-01   Ready    &lt;none&gt;          111s   v1.33.1
</span></span></code></pre></div><p>we can see that node wnode-01 has joined the cluster.</p><p>When joining a new node , it is a best practice according to the documentation to rebalance the coreDNS pods for better availability.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>kubectl -n kube-system rollout restart deployment coredns
</span></span></code></pre></div><h2 id=checking>Checking</h2><p>we check the nodes is okay and the pods are running.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>david@node:~$ kubectl get pods --all-namespaces
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>NAMESPACE      NAME                           READY   STATUS              RESTARTS        AGE
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>kube-flannel   kube-flannel-ds-6mmcx          0/1     CrashLoopBackOff    <span style=color:#bd93f9>6</span> <span style=color:#ff79c6>(</span>22s ago<span style=color:#ff79c6>)</span>     6m36s
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>kube-flannel   kube-flannel-ds-f2kgs          1/1     Running             <span style=color:#bd93f9>28</span> <span style=color:#ff79c6>(</span>111m ago<span style=color:#ff79c6>)</span>   14h
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>kube-system    coredns-674b8bbfcf-fg6k4       1/1     Running             <span style=color:#bd93f9>17</span> <span style=color:#ff79c6>(</span>115m ago<span style=color:#ff79c6>)</span>   15h
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>kube-system    coredns-84464579f8-q82sc       0/1     ContainerCreating   <span style=color:#bd93f9>0</span>               3m31s
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>kube-system    coredns-84464579f8-tpmnl       0/1     ContainerCreating   <span style=color:#bd93f9>0</span>               3m31s
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>kube-system    etcd-node                      1/1     Running             <span style=color:#bd93f9>36</span> <span style=color:#ff79c6>(</span>114m ago<span style=color:#ff79c6>)</span>   15h
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>kube-system    kube-apiserver-node            1/1     Running             <span style=color:#bd93f9>37</span> <span style=color:#ff79c6>(</span>112m ago<span style=color:#ff79c6>)</span>   15h
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>kube-system    kube-controller-manager-node   1/1     Running             <span style=color:#bd93f9>33</span> <span style=color:#ff79c6>(</span>18m ago<span style=color:#ff79c6>)</span>    15h
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>kube-system    kube-proxy-wfzds               1/1     Running             <span style=color:#bd93f9>39</span> <span style=color:#ff79c6>(</span>112m ago<span style=color:#ff79c6>)</span>   15h
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>kube-system    kube-proxy-wkjz4               1/1     Running             <span style=color:#bd93f9>0</span>               6m36s
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>kube-system    kube-scheduler-node            1/1     Running             <span style=color:#bd93f9>36</span> <span style=color:#ff79c6>(</span>18m ago<span style=color:#ff79c6>)</span>    15h
</span></span></code></pre></div><p>we have an issue with the flannel pod , most likely in the new node that has joined the cluster and is not able to start the flannel pod.</p><p>We check the logs</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>david@node:~$ kubectl logs kube-flannel-ds-6mmcx   -n kube-flannel
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>Defaulted container <span style=color:#f1fa8c>&#34;kube-flannel&#34;</span> out of: kube-flannel, install-cni-plugin <span style=color:#ff79c6>(</span>init<span style=color:#ff79c6>)</span>, install-cni <span style=color:#ff79c6>(</span>init<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>I0517 12:18:28.790795       <span style=color:#bd93f9>1</span> main.go:211<span style=color:#ff79c6>]</span> CLI flags config: <span style=color:#ff79c6>{</span>etcdEndpoints:http://127.0.0.1:4001,http://127.0.0.1:2379 etcdPrefix:/coreos.com/network etcdKeyfile: etcdCertfile: etcdCAFile: etcdUsername: etcdPassword: version:false kubeSubnetMgr:true kubeApiUrl: kubeAnnotationPrefix:flannel.alpha.coreos.com kubeConfigFile: iface:<span style=color:#ff79c6>[]</span> ifaceRegex:<span style=color:#ff79c6>[]</span> ipMasq:true ifaceCanReach: subnetFile:/run/flannel/subnet.env publicIP: publicIPv6: subnetLeaseRenewMargin:60 healthzIP:0.0.0.0 healthzPort:0 iptablesResyncSeconds:5 iptablesForwardRules:true netConfPath:/etc/kube-flannel/net-conf.json setNodeNetworkUnavailable:true<span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>W0517 12:18:28.790909       <span style=color:#bd93f9>1</span> client_config.go:618<span style=color:#ff79c6>]</span> Neither --kubeconfig nor --master was specified.  Using the inClusterConfig.  This might not work.
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>I0517 12:18:28.804246       <span style=color:#bd93f9>1</span> kube.go:139<span style=color:#ff79c6>]</span> Waiting 10m0s <span style=color:#ff79c6>for</span> node controller to sync
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>I0517 12:18:28.804286       <span style=color:#bd93f9>1</span> kube.go:469<span style=color:#ff79c6>]</span> Starting kube subnet manager
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>I0517 12:18:28.812871       <span style=color:#bd93f9>1</span> kube.go:490<span style=color:#ff79c6>]</span> Creating the node lease <span style=color:#ff79c6>for</span> IPv4. This is the n.Spec.PodCIDRs: <span style=color:#ff79c6>[</span>10.244.0.0/24<span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>I0517 12:18:29.808642       <span style=color:#bd93f9>1</span> kube.go:146<span style=color:#ff79c6>]</span> Node controller sync successful
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>I0517 12:18:29.808678       <span style=color:#bd93f9>1</span> main.go:231<span style=color:#ff79c6>]</span> Created subnet manager: Kubernetes Subnet Manager - wnode-01
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>I0517 12:18:29.808680       <span style=color:#bd93f9>1</span> main.go:234<span style=color:#ff79c6>]</span> Installing signal handlers
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>I0517 12:18:29.809284       <span style=color:#bd93f9>1</span> main.go:468<span style=color:#ff79c6>]</span> Found network config - Backend type: vxlan
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>E0517 12:18:29.809317       <span style=color:#bd93f9>1</span> main.go:268<span style=color:#ff79c6>]</span> Failed to check br_netfilter: stat /proc/sys/net/bridge/bridge-nf-call-iptables: no such file or directory
</span></span></code></pre></div><p>We fix:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>david@wnode-01:~$ cat <span style=color:#f1fa8c>&lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#f1fa8c>overlay
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#f1fa8c>br_netfilter
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#f1fa8c>EOF</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>overlay
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>br_netfilter
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>david@wnode-01:~$ sudo modprobe overlay
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>sudo modprobe br_netfilter
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>david@wnode-01:~$
</span></span></code></pre></div><p>We wait the relaunch of the pods and check the status:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>watch -d -n <span style=color:#bd93f9>1</span> <span style=color:#f1fa8c>&#39;kubectl get pods --all-namespaces -o wide&#39;</span>
</span></span></code></pre></div><p>And now seems to be good to go:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>Every 1.0s: kubectl get pods --all-namespaces -o wide                                                              node: Sat May <span style=color:#bd93f9>17</span> 14:24:08 <span style=color:#bd93f9>2025</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>NAMESPACE      NAME                           READY   STATUS    RESTARTS        AGE   IP             NODE       NOMINATED NODE   READINESS GATES
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>kube-flannel   kube-flannel-ds-6mmcx          1/1     Running   <span style=color:#bd93f9>8</span> <span style=color:#ff79c6>(</span>5m39s ago<span style=color:#ff79c6>)</span>   17m   192.168.1.98   wnode-01   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>kube-flannel   kube-flannel-ds-f2kgs          1/1     Running   <span style=color:#bd93f9>28</span> <span style=color:#ff79c6>(</span>121m ago<span style=color:#ff79c6>)</span>   15h   192.168.1.18   node       &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>kube-system    coredns-84464579f8-q82sc       1/1     Running   <span style=color:#bd93f9>0</span>               13m   10.244.1.2     wnode-01   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>kube-system    coredns-84464579f8-tpmnl       1/1     Running   <span style=color:#bd93f9>0</span>               13m   10.244.1.3     wnode-01   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>kube-system    etcd-node                      1/1     Running   <span style=color:#bd93f9>36</span> <span style=color:#ff79c6>(</span>125m ago<span style=color:#ff79c6>)</span>   15h   192.168.1.18   node       &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>kube-system    kube-apiserver-node            1/1     Running   <span style=color:#bd93f9>37</span> <span style=color:#ff79c6>(</span>122m ago<span style=color:#ff79c6>)</span>   15h   192.168.1.18   node       &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>kube-system    kube-controller-manager-node   1/1     Running   <span style=color:#bd93f9>33</span> <span style=color:#ff79c6>(</span>28m ago<span style=color:#ff79c6>)</span>    15h   192.168.1.18   node       &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>kube-system    kube-proxy-wfzds               1/1     Running   <span style=color:#bd93f9>39</span> <span style=color:#ff79c6>(</span>122m ago<span style=color:#ff79c6>)</span>   15h   192.168.1.18   node       &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>kube-system    kube-proxy-wkjz4               1/1     Running   <span style=color:#bd93f9>0</span>               17m   192.168.1.98   wnode-01   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>kube-system    kube-scheduler-node            1/1     Running   <span style=color:#bd93f9>36</span> <span style=color:#ff79c6>(</span>28m ago<span style=color:#ff79c6>)</span>    15h   192.168.1.18   node       &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>We have added a node to the cluster and it is running.</p></div></article><div class=blog-post-comments><div id=cactus-comments-thread><script>initComments({node:document.getElementById("cactus-comments-thread"),defaultHomeserverUrl:"https://matrix.cactus.chat:8448",serverName:"cactus.chat",siteName:"your_cactus_comments_sitename",commentSectionId:"/posts/k8s-part2-adding-node/"})</script></div></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Main</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li><li><a href=/posts/>Posts</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#rationale>Rationale</a></li><li><a href=#pre-requisites>Pre-requisites</a><ul><li><a href=#setup-the-node-on-vanilla-debian>Setup the node on vanilla Debian</a></li><li><a href=#disable-swap>Disable swap</a></li><li><a href=#install-runtime>install runtime</a></li><li><a href=#install-tooling-and-kubelet>Install tooling and kubelet</a></li></ul></li><li><a href=#adding-the-node-to-the-cluster>Adding the node to the cluster</a><ul><li><a href=#getting-the-token>Getting the token</a></li><li><a href=#getting-the-hash>Getting the hash</a></li><li><a href=#joining-the-node-to-the-cluster>Joining the node to the cluster</a></li><li><a href=#checking-nodes-on-control-plane>Checking nodes on control plane</a></li></ul></li><li><a href=#checking>Checking</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&text=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&title=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&is_video=false&description=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node&body=Check out this article: https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&title=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&title=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&name=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node&description=%3ch2%20id%3d%22rationale%22%3eRationale%3c%2fh2%3e%0a%3cp%3eIn%20our%20previous%20%3ca%20href%3d%22posts%2f2025-05-16.k8s.install%2f%22%3epost%3c%2fa%3e%20we%20installed%20Kubernetes%20control%20plane%20on%20a%20single%20node.%20Now%20we%20want%20to%20add%20a%20second%20node%20to%20our%20cluster%20to%20run%20our%20workloads.%20We%20will%20follow%20official%20%3ca%20href%3d%22https%3a%2f%2fkubernetes.io%2fdocs%2ftasks%2fadminister-cluster%2fkubeadm%2fadding-linux-nodes%2f%22%3edocumentation%3c%2fa%3e%20to%20add%20a%20node%20to%20our%20cluster.%3c%2fp%3e%0a%3ch2%20id%3d%22pre-requisites%22%3ePre-requisites%3c%2fh2%3e%0a%3cp%3eBefore%20we%20join%20a%20node%20to%20the%20cluster%2c%20we%20need%20to%20have%20a%20node%20with%20the%20following%20%3a%3c%2fp%3e%0a%3cul%3e%0a%3cli%3eshould%20have%20tooling%20installed%20%28kubeadm%2c%20kubelet%29%3c%2fli%3e%0a%3cli%3eshould%20have%20a%20container%20runtime%20installed%20%28containerd%20in%20our%20case%29%3c%2fli%3e%0a%3cli%3ewe%20need%20super-user%20access%20to%20the%20node.%3c%2fli%3e%0a%3c%2ful%3e%0a%3ch3%20id%3d%22setup-the-node-on-vanilla-debian%22%3eSetup%20the%20node%20on%20vanilla%20Debian%3c%2fh3%3e%0a%3cp%3efor%20the%20ease%20of%20setup%2c%20I%20will%20duplicate%20a%20template%20VM%20I%26rsquo%3bve%20created%20before%2c%20I%20will%20just%20rename%20it%20to%20%3ccode%3ewnode-01%3c%2fcode%3e%20for%20worker-node-01%20and%20change%20the%20hostname.%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fdavmig.github.io%2fposts%2fk8s-part2-adding-node%2f&t=Installation%20of%20Kubernetes%20on%20Debian%20Part%202%20-%20Adding%20a%20Node" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><script>document.addEventListener("DOMContentLoaded",function(){if(typeof GLightbox!="undefined"){const e=GLightbox({selector:".lightbox",touchNavigation:!0,loop:!0});e.on("open",()=>{const e=window.innerWidth-document.documentElement.clientWidth;document.body.style.paddingRight=e+"px"}),e.on("close",()=>{document.body.style.paddingRight=""})}})</script><div class=footer-left>Copyright &copy; 2026 Zaft Memory Core</div><div class=footer-right><nav><ul><li><a href=/>Main</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li><li><a href=/posts/>Posts</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script></html>